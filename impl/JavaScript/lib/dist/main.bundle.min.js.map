{
  "version": 3,
  "sources": ["../src/binascii.js", "../src/random.js", "../src/str.js", "../src/exceptions.js", "../src/loader.js", "../src/scrypt-layer/dynamic-compile.js", "../src/derive_key.js", "../src/encrypt_data.js", "../src/encrypt_file.js", "../src/key_management.js", "../src/context.js", "../src/stream.js", "../src/version.js"],
  "sourcesContent": ["const hexTable = new Array(256);\r\nfor (let i = 0; i < 256; i++) {\r\n    hexTable[i] = i.toString(16).padStart(2, '0');\r\n}\r\n\r\n/**\r\n * @param {Uint8Array} data\r\n * @returns {string}\r\n */\r\nexport function hexlify(data) {\r\n    if (!data || !(data instanceof Uint8Array)) {\r\n        throw new TypeError(\"Input must be a Uint8Array\");\r\n    }\r\n    const length = data.length;\r\n    const arr = new Array(length);\r\n    for (let i = 0; i < length; i++) {\r\n        arr[i] = hexTable[data[i]];\r\n    }\r\n    return arr.join('');\r\n}\r\n\r\nconst throwing = {\r\n    get InvalidHexStringException() {\r\n        throw new TypeError('Invalid hex string');\r\n    },\r\n}\r\n\r\n/**\r\n * @param {string} hexStr\r\n * @returns {Uint8Array}\r\n */\r\nexport function unhexlify(hexStr) {\r\n    if (typeof hexStr !== 'string') {\r\n        throw new TypeError(\"Input must be a string\");\r\n    }\r\n    const length = hexStr.length;\r\n    if (length % 2 !== 0) {\r\n        throw new TypeError(\"Hex string must have even length\");\r\n    }\r\n    hexStr = hexStr.toLowerCase();\r\n    const bytes = new Uint8Array(length >> 1);\r\n    for (let i = 0; i < length; i += 2) {\r\n        const highCode = hexStr.charCodeAt(i);\r\n        const lowCode = hexStr.charCodeAt(i + 1);\r\n\r\n        const high = highCode >= 97 && highCode <= 102 ? highCode - 87 :\r\n            highCode >= 48 && highCode <= 57 ? highCode - 48 : throwing.InvalidHexStringException;\r\n        const low = lowCode >= 97 && lowCode <= 102 ? lowCode - 87 :\r\n            lowCode >= 48 && lowCode <= 57 ? lowCode - 48 : throwing.InvalidHexStringException;\r\n\r\n        // @ts-ignore\r\n        bytes[i >> 1] = (high << 4) | low;\r\n    }\r\n    return bytes;\r\n}", "/**\r\n * @param {number} count\r\n */\r\nexport function get_random_bytes(count) {\r\n    const randomBytes = new Uint8Array(count);\r\n    crypto.getRandomValues(randomBytes);\r\n    return randomBytes;\r\n}\r\nexport function get_random_int8_number() {\r\n    const randomBytes = get_random_bytes(1);\r\n    return new Int8Array(randomBytes)[0];\r\n}\r\nexport function get_random_uint8_number() {\r\n    const randomBytes = get_random_bytes(1);\r\n    return new Uint8Array(randomBytes)[0];\r\n}", "/**\r\n * @param {string} input\r\n */\r\nexport function str_encode(input, encoding = \"utf-8\") {\r\n    if (typeof input !== \"string\") {\r\n        throw new TypeError(\"Input must be a string\");\r\n    }\r\n    if (encoding.toLowerCase() !== \"utf-8\") {\r\n        throw new Error(\"Only 'utf-8' encoding is supported\");\r\n    }\r\n    return new TextEncoder().encode(input);\r\n}\r\n/**\r\n * @param {Uint8Array|ArrayBuffer} input\r\n */\r\nexport function str_decode(input, encoding = \"utf-8\") {\r\n    if (!(input instanceof Uint8Array)) {\r\n        input = new Uint8Array(input);\r\n    }\r\n    if (encoding.toLowerCase() !== \"utf-8\") {\r\n        throw new Error(\"Only 'utf-8' encoding is supported\");\r\n    }\r\n    return new TextDecoder().decode(input);\r\n}", "export class EncryptionError extends Error {\r\n    constructor(message = 'Encryption Error', additional = undefined) {\r\n        super(message, additional);\r\n        this.name = 'EncryptionError';\r\n    }\r\n}\r\n\r\nexport class InternalError extends EncryptionError {\r\n    constructor(message = '(Internal Error)', additional = undefined) {\r\n        super(message, additional);\r\n        this.name = 'InternalError';\r\n    }\r\n}\r\n\r\nexport function raise(message, additional) {\r\n    throw new InternalError(message, additional);\r\n}\r\n\r\nexport class InvalidParameterException extends EncryptionError {\r\n    constructor(message = 'The parameter provided is invalid.', additional = undefined) {\r\n        super(message, additional);\r\n        this.name = 'InvalidParameterException';\r\n    }\r\n}\r\n\r\nexport class BadDataException extends EncryptionError {\r\n    constructor(message = 'The data is bad.', additional = undefined) {\r\n        super(message, additional);\r\n        this.name = 'BadDataException';\r\n    }\r\n}\r\n\r\nexport class InvalidScryptParameterException extends EncryptionError {\r\n    constructor(message = 'The N, r, or p is not valid or out of range.', additional = undefined) {\r\n        super(message, additional);\r\n        this.name = 'InvalidScryptParameterException';\r\n    }\r\n}\r\n\r\nexport class EncryptionVersionMismatchException extends EncryptionError {\r\n    constructor(message = 'The version of the encryption library doesn\\'t match.', additional = undefined) {\r\n        super(message, additional);\r\n        this.name = 'EncryptionVersionMismatchException';\r\n    }\r\n}\r\n\r\nexport class InvalidFileFormatException extends EncryptionError {\r\n    constructor(message = 'The file format is invalid.', additional = undefined) {\r\n        super(message, additional);\r\n        this.name = 'InvalidFileFormatException';\r\n    }\r\n}\r\n\r\nexport class IVException extends EncryptionError {\r\n    constructor(message = 'IV Exception.', additional = undefined) {\r\n        super(message, additional);\r\n        this.name = 'IVException';\r\n    }\r\n}\r\n\r\nexport class FileCorruptedException extends EncryptionError {\r\n    constructor(message = 'File is corrupted.', additional = undefined) {\r\n        super(message, additional);\r\n        this.name = 'FileCorruptedException';\r\n    }\r\n}\r\n\r\nexport class InvalidEndMarkerException extends EncryptionError {\r\n    constructor(message = 'The end marker is invalid.', additional = undefined) {\r\n        super(message, additional);\r\n        this.name = 'InvalidEndMarkerException';\r\n    }\r\n}\r\n\r\nexport class CannotDecryptException extends EncryptionError {\r\n    constructor(message = 'Cannot decrypt', additional = undefined) {\r\n        super(message, additional);\r\n        this.name = 'CannotDecryptException';\r\n    }\r\n}\r\n\r\nexport class CryptContextReusedException extends EncryptionError {\r\n    constructor(message = 'Not allowed to reuse a crypt context.', additional = undefined) {\r\n        super(message, additional);\r\n        this.name = 'CryptContextReusedException';\r\n    }\r\n}\r\n\r\nexport class NotSupportedException extends EncryptionError {\r\n    constructor(message = 'Operation not supported', additional = undefined) {\r\n        super(message, additional);\r\n        this.name = 'NotSupportedException';\r\n    }\r\n}\r\n\r\nexport class EndOfFileException extends EncryptionError {\r\n    constructor(message = 'End of File', additional = undefined) {\r\n        super(message, additional);\r\n        this.name = 'EndOfFileException';\r\n    }\r\n}\r\n\r\nexport class CryptContextNotInitedException extends EncryptionError {\r\n    constructor(message = 'Crypt context is not initialized.', additional = undefined) {\r\n        super(message, additional);\r\n        this.name = 'CryptContextNotInitedException';\r\n    }\r\n}\r\n\r\nexport class InvalidCryptContextTypeException extends EncryptionError {\r\n    constructor(message = 'Invalid crypt context type.', additional = undefined) {\r\n        super(message, additional);\r\n        this.name = 'InvalidCryptContextTypeException';\r\n    }\r\n}\r\n\r\nexport class CryptContextReleasedException extends EncryptionError {\r\n    constructor(message = 'Crypt context has been released.', additional = undefined) {\r\n        super(message, additional);\r\n        this.name = 'CryptContextReleasedException';\r\n    }\r\n}\r\n", "export function load_script(src) {\r\n    return new Promise((resolve, reject) => {\r\n        const script = document.createElement('script');\r\n        script.src = src;\r\n        script.onload = () => resolve(script);\r\n        script.onerror = e => reject(e);\r\n        document.head.append(script);\r\n    });\r\n}\r\n\r\nexport function load_module(src) {\r\n    return import(src); // just a wrapper\r\n}\r\n\r\nexport function load_deps_es5(deps_name, deps_src) {\r\n    if (Reflect.has(globalThis, deps_name)) return Promise.resolve(Reflect.get(globalThis, deps_name));\r\n    return load_script(deps_src).then(() => {\r\n        return Reflect.get(globalThis, deps_name);\r\n    });\r\n}", "import { load_deps_es5 } from \"../loader.js\";\r\nconst scryptAPI = await load_deps_es5('scrypt', import.meta.resolve('./WebScrypt/scrypt.js'));\r\nscryptAPI.setResPath(import.meta.resolve('./WebScrypt/asset/'));\r\nscryptAPI.load();\r\n\r\n\r\n\r\n// \u5BF9 WebScrypt \u7684\u81EA\u5B9A\u4E49\u5C01\u88C5\r\nexport const scrypt = (function () {\r\n    const queue = [];\r\n    let running = false;\r\n    const work = (task) => new Promise(async (resolve, reject) => {\r\n        scryptAPI.onprogress = p => {\r\n            if (task.onprogress) task.onprogress(p);\r\n        };\r\n        scryptAPI.oncomplete = dk => {\r\n            task.resolve(dk);\r\n            resolve(true);\r\n        };\r\n        scryptAPI.onerror = e => {\r\n            task.reject(e);\r\n            resolve(false);\r\n        };\r\n        try {\r\n            scryptAPI.config({ N: task.N, r: task.r, P: task.p }, { maxPassLen: 8192, maxSaltLen: 2048, maxDkLen: 1024, maxThread: 1 });\r\n            await new Promise(r => scryptAPI.onready = r);\r\n            scryptAPI.hash(task.key, task.salt, task.dklen);\r\n        } catch (e) {\r\n            reject(e);\r\n        }\r\n    });\r\n    async function thread() {\r\n        let task = null;\r\n        while (queue.length) try {\r\n            task = queue.splice(0, 1)[0];\r\n            await work(task);\r\n            await nextTick();\r\n        } catch (e) {\r\n            task?.reject(e);\r\n        }\r\n        running = false;\r\n    }\r\n    return function scrypt(key, salt, N, r, p, dklen, onprogress = null) {\r\n        return new Promise((resolve, reject) => {\r\n            queue.push({\r\n                key, salt, N, r, p, dklen, resolve, reject, onprogress\r\n            });\r\n            if (!running) {\r\n                running = true;\r\n                setTimeout(thread); // \u542F\u52A8\u5B8F\u4EFB\u52A1\r\n            }\r\n        });\r\n    }\r\n})();\r\n\r\n\r\nfunction nextTick() {\r\n    return new Promise(r => setTimeout(r));\r\n}", "import { hexlify } from \"./binascii.js\";\r\nimport { get_random_bytes, get_random_uint8_number } from \"./random.js\";\r\nimport { str_encode } from \"./str.js\";\r\nimport * as Exceptions from './exceptions.js';\r\nimport { scrypt } from './scrypt-layer/entrance.js';\r\n\r\nexport const deriveKey__phrases = ['Furina', 'Neuvillette', 'Venti', 'Nahida', 'Kinich', 'Kazuha'];\r\nexport async function derive_key(key, iv, phrase = null, N = null, salt = null, r = 8, p = 1, dklen = 32) {\r\n    if (N === null) N = 262144;\r\n    if (typeof N !== \"number\" || N > 2097152) {\r\n        throw new Exceptions.InvalidScryptParameterException();\r\n    }\r\n\r\n    // (2) \u751F\u6210salt\r\n    if (!salt) {\r\n        salt = get_random_bytes(64);\r\n    }\r\n\r\n    // \u5904\u7406phrase\r\n    if (!phrase) {\r\n        phrase = deriveKey__phrases[(get_random_uint8_number()) % deriveKey__phrases.length];\r\n    }\r\n    if (phrase.includes(\":\")) {\r\n        throw new Exceptions.InvalidParameterException(\"phrase MUST NOT contain \\\":\\\"\");\r\n    }\r\n\r\n    const parameter = `${phrase}:${hexlify(salt)}`;\r\n\r\n    // (3) \u751F\u6210\u52A0\u5BC6\u5BC6\u94A5\r\n    const keyInput = `MyEncryption/1.1 Fontaine/4.2 Iv/${hexlify(iv)} user_parameter=${parameter} user_key=${key}`;\r\n\r\n    // \u4F7F\u7528Scrypt\u8FDB\u884C\u5BC6\u94A5\u6D3E\u751F(pycryptodome\u6CA1\u6709PBKDF2HMAC\uFF0C\u4F7F\u7528Scrypt\u4F5C\u4E3A\u66FF\u4EE3)\r\n    // AES-256\u9700\u898132\u5B57\u8282\u5BC6\u94A5\r\n    const derived_key = await scrypt(str_encode(keyInput), salt, N, r, p, dklen)\r\n\r\n    return ({ derived_key, parameter, N });\r\n}\r\n\r\n\r\nexport async function scrypt_hex(key, salt, N, r, p, dklen) {\r\n    return hexlify(await scrypt(str_encode(key), str_encode(salt), N, r, p, dklen));\r\n}\r\n\r\nexport { scrypt };", "import { get_random_bytes } from \"./random.js\";\r\nimport { derive_key } from \"./derive_key.js\";\r\nimport { hexlify, unhexlify } from \"./binascii.js\";\r\nimport { str_decode, str_encode } from \"./str.js\";\r\nimport * as Exceptions from './exceptions.js';\r\n\r\nfunction safeparse(json) {\r\n    try {\r\n        return JSON.parse(json);\r\n    } catch {\r\n        throw new Exceptions.InvalidParameterException('The JSON is not valid.');\r\n    }\r\n}\r\n\r\n/**\r\n * @param {string | Uint8Array} message\r\n * @param {string} key\r\n * @param {?string} [phrase] phrase\r\n * @param {number} [N] N\r\n */\r\nexport async function encrypt_data(message, key, phrase = null, N = null) {\r\n    // (1) \u751F\u6210\u968F\u673AIV (12 bytes for GCM)\r\n    const iv = get_random_bytes(12);\r\n\r\n    // \u6D3E\u751F\u5BC6\u94A5\r\n    const { derived_key, parameter, N: N2 } = await derive_key(key, iv, phrase, N);\r\n    N = N2;\r\n\r\n    // (4) \u52A0\u5BC6\u6D88\u606F\r\n    const cipher = await crypto.subtle.importKey(\"raw\", derived_key, \"AES-GCM\", false, [\"encrypt\"]);\r\n\r\n    if (typeof message === \"string\") {\r\n        message = str_encode(message);\r\n    }\r\n\r\n    const ciphertext = await crypto.subtle.encrypt(\r\n        {\r\n            name: \"AES-GCM\",\r\n            iv: iv\r\n        },\r\n        cipher,\r\n        message\r\n    );\r\n\r\n    // \u7EC4\u5408IV + \u5BC6\u6587 + \u8BA4\u8BC1\u6807\u7B7E\r\n    const encrypted_message = new Uint8Array(iv.length + ciphertext.byteLength);\r\n    encrypted_message.set(iv, 0);\r\n    encrypted_message.set(new Uint8Array(ciphertext), iv.length);\r\n    const message_encrypted = hexlify(encrypted_message);\r\n\r\n    return JSON.stringify({\r\n        data: message_encrypted,\r\n        parameter: parameter,\r\n        N: N,\r\n        v: 5.5\r\n    });\r\n}\r\n\r\n\r\n/**\r\n * @param {string} message_encrypted\r\n * @param {string} key\r\n */\r\nexport async function decrypt_data(message_encrypted, key) {\r\n    const jsoned = safeparse(message_encrypted);\r\n    const parameter = jsoned.parameter;\r\n    const N = parseInt(jsoned.N);\r\n\r\n    // \u5C06\u5341\u516D\u8FDB\u5236\u5B57\u7B26\u4E32\u8F6C\u6362\u56DE\u5B57\u8282\r\n    const encrypted_data = unhexlify(jsoned.data);\r\n    const [phrase, salt_b64] = parameter.split(':');\r\n    const salt = unhexlify(salt_b64);\r\n\r\n    if (isNaN(N) || !parameter || !encrypted_data || !salt) throw new Exceptions.BadDataException('The message or parameters are bad.')\r\n    if (encrypted_data.length < 28) throw new Exceptions.BadDataException(\"The message was too short.\");\r\n\r\n    // \u63D0\u53D6 IV (\u524D12\u5B57\u8282)\u3001\u5BC6\u6587\u548C\u8BA4\u8BC1\u6807\u7B7E(\u6700\u540E16\u5B57\u8282)\r\n    const iv = encrypted_data.slice(0, 12);\r\n    const ciphertext = encrypted_data.slice(12, -16);\r\n    const tag = encrypted_data.slice(-16);\r\n\r\n    const { derived_key } = await derive_key(key, iv, phrase, N, salt);\r\n\r\n    const cipher = await crypto.subtle.importKey(\"raw\", derived_key, \"AES-GCM\", false, [\"decrypt\"]);\r\n\r\n    try {\r\n        const decrypted_data = await crypto.subtle.decrypt(\r\n            {\r\n                name: \"AES-GCM\",\r\n                iv: iv,\r\n            },\r\n            cipher,\r\n            new Uint8Array([...ciphertext, ...tag])\r\n        );\r\n\r\n        try {\r\n            return str_decode(decrypted_data);\r\n        } catch {\r\n            return decrypted_data;\r\n        }\r\n    }\r\n    catch (e) {\r\n        if (!e) throw new Exceptions.InternalError(`Internal error.`, { cause: e });\r\n        const name = e.name;\r\n        if (name === 'InvalidAccessError') throw new Exceptions.InvalidParameterException('InvalidAccessError.', { cause: e });\r\n        if (name === 'OperationError') throw new Exceptions.CannotDecryptException('Cannot decrypt. Did you provide the correct password?', { cause: e });\r\n        if (!e) throw new Exceptions.InternalError(`Unexpected error.`, { cause: e });\r\n    }\r\n}\r\n\r\n", "import { derive_key } from \"./derive_key.js\";\r\nimport { hexlify, unhexlify } from \"./binascii.js\";\r\nimport { get_random_bytes } from \"./random.js\";\r\nimport { str_encode, str_decode } from \"./str.js\";\r\nimport { encrypt_data, decrypt_data } from \"./encrypt_data.js\";\r\nimport * as Exceptions from './exceptions.js';\r\n\r\n// @ts-ignore\r\nconst timerproc = (typeof process === 'undefined') ?\r\n    requestAnimationFrame : // browser\r\n    setTimeout; // node.js\r\nfunction nextTick() {\r\n    return new Promise(r => timerproc(r));\r\n}\r\n\r\nexport const PADDING_SIZE = 4096; // 4096 bytes\r\nexport const END_IDENTIFIER = [\r\n    0x55, 0xAA, 0x55, 0xAA, 0x55, 0xAA, 0x55, 0xAA,\r\n];\r\nexport const TAIL_BLOCK_MARKER = [\r\n    0x55, 0xAA, 0x55, 0xAA, 0x55, 0xAA, 0x55, 0xAA,\r\n    0xAA, 0x55, 0xAA, 0x55, 0xAA, 0x55, 0xAA, 0x55,\r\n    0x55, 0xAA, 0x55, 0xAA, 0x55, 0xAA, 0x55, 0xAA,\r\n    0xAA, 0x55, 0xAA, 0x55, 0xAA, 0x55, 0xAA, 0x55,\r\n];\r\nexport const END_MARKER = [\r\n    0x55, 0xAA, 0x55, 0xAA, 0x55, 0xAA, 0x55, 0xAA,\r\n    0x55, 0xAA, 0x55, 0xAA, 0x55, 0xAA, 0x55, 0xAA,\r\n    0x55, 0xAA, 0x55, 0xAA, 0x55, 0xAA, 0x55, 0xAA,\r\n    0x55, 0xAA, 0x55, 0xAA, 0x55, 0xAA, 0x55, 0xAA,\r\n];\r\nexport const FILE_END_MARKER = [0xFF, 0xFD, 0xF0, 0x10, 0x13, 0xD0, 0x12, 0x18, 0x55, 0xAA];\r\n\r\n/**\r\n * @param {string} major_version\r\n * @param {number} [version_marker]\r\n */\r\nexport function normalize_version(major_version, version_marker) {\r\n    if (!major_version) return `Unknown Version`;\r\n    if (String(major_version) === '1.1') version_marker = null;\r\n    if (!version_marker) return `${major_version}/0`;\r\n    return `${major_version}/${version_marker}`;\r\n}\r\n\r\n// versions\r\nexport const ENCRYPTION_FILE_VER_1_1_0 = normalize_version('1.1');\r\nexport const ENCRYPTION_FILE_VER_1_2_10020 = normalize_version('1.2', 10020);\r\n\r\n/**\r\n * \u52A0\u5BC6\u6587\u4EF6\r\n * @param {Function} file_reader - \u6587\u4EF6\u8BFB\u53D6\u5668\u5BF9\u8C61\uFF0C\u9700\u8981\u5B9E\u73B0(start, end) => Promise<Uint8Array>\r\n * @param {Function} file_writer - \u6587\u4EF6\u5199\u5165\u5668\u5BF9\u8C61\uFF0C\u9700\u8981\u5B9E\u73B0write(Uint8Array)\u65B9\u6CD5\r\n * @param {string} user_key - \u7528\u6237\u5BC6\u94A5\r\n * @param {string|null} phrase - \u53EF\u9009\u77ED\u8BED\uFF0C\u7528\u4E8E\u5BC6\u94A5\u6D3E\u751F\r\n * @param {number|null} N - scrypt\u53C2\u6570N\r\n * @param {number} chunk_size - \u5206\u5757\u5927\u5C0F\uFF0C\u9ED8\u8BA4\u4E3A32MiB\r\n * @returns {Promise<boolean>} \u8FD4\u56DE\u52A0\u5BC6\u662F\u5426\u6210\u529F\r\n */\r\nexport async function encrypt_file(file_reader, file_writer, user_key, callback = null, phrase = null, N = null, chunk_size = 32 * 1024 * 1024) {\r\n    if (!chunk_size) throw new Exceptions.InvalidParameterException('chunk_size must be greater than 0.');\r\n\r\n    // \u5199\u5165\u6587\u4EF6\u5934\u6807\u8BC6\u548C\u7248\u672C (16\u5B57\u8282)\r\n    await file_writer(str_encode('MyEncryption/1.2'));\r\n\r\n    // \u5199\u5165\u7248\u672C\u6807\u8BC6\u7B26\r\n    const VERSION_MARKER = 10020;\r\n    const versionMarkerBuffer = new ArrayBuffer(4);\r\n    new DataView(versionMarkerBuffer).setUint32(0, VERSION_MARKER, true);\r\n    await file_writer(new Uint8Array(versionMarkerBuffer));\r\n\r\n    // \u4EA7\u751F\u4E3B\u5BC6\u94A5\r\n    // TODO: \u4E3B\u5BC6\u94A5\u7684\u968F\u673A\u6027\u975E\u5E38\u91CD\u8981\uFF01\u8003\u8651\u8BA9\u7528\u6237\u79FB\u52A8\u9F20\u6807\u6765\u6536\u96C6\u968F\u673A\u6027\r\n    const key = hexlify(get_random_bytes(64));\r\n    const ekey = await encrypt_data(key, user_key);\r\n    const ekey_bytes = str_encode(ekey);\r\n\r\n    // \u68C0\u67E5\u957F\u5EA6\r\n    if (ekey_bytes.length > PADDING_SIZE) {\r\n        throw new Exceptions.InternalError(\"(Internal Error) This should not happen. Contact the application developer.\");\r\n    }\r\n\r\n    // \u5199\u5165\u4E3B\u5BC6\u94A5\u5BC6\u6587\u957F\u5EA6(4\u5B57\u8282)\u548C\u5185\u5BB9\uFF0C\u586B\u5145\u5230PADDING_SIZE\u5B57\u8282\r\n    const lengthBuffer = new ArrayBuffer(4);\r\n    new DataView(lengthBuffer).setUint32(0, ekey_bytes.length, true);\r\n    await file_writer(new Uint8Array(lengthBuffer));\r\n    await file_writer(ekey_bytes);\r\n\r\n    // \u586B\u5145\u5269\u4F59\u7A7A\u95F4\r\n    const padding = new Uint8Array(PADDING_SIZE - ekey_bytes.length - 4).fill(0);\r\n    await file_writer(padding);\r\n\r\n    // \u751F\u6210\u521D\u59CBIV\u7528\u4E8E\u6D3E\u751F\u5BC6\u94A5 (12\u5B57\u8282)\r\n    callback?.(0); await nextTick();\r\n    const iv_for_key = get_random_bytes(12);\r\n    const { derived_key, parameter, N: N2 } = await derive_key(key, iv_for_key, phrase, N);\r\n    N = N2;\r\n\r\n    // \u51C6\u5907\u5934\u90E8JSON\u6570\u636E\r\n    const header_data = {\r\n        \"parameter\": parameter,\r\n        \"N\": N,\r\n        \"v\": 5.5,\r\n        \"iv\": hexlify(iv_for_key)\r\n    };\r\n    const header_json = str_encode(JSON.stringify(header_data));\r\n\r\n    // \u5199\u5165JSON\u957F\u5EA6(4\u5B57\u8282)\u548CJSON\u6570\u636E\r\n    const headerLengthBuffer = new ArrayBuffer(4);\r\n    new DataView(headerLengthBuffer).setUint32(0, header_json.length, true);\r\n    await file_writer(new Uint8Array(headerLengthBuffer));\r\n    await file_writer(header_json);\r\n\r\n    // \u5199\u5165chunk size\u53C2\u6570\r\n    const chunkSizeBuffer = new ArrayBuffer(8);\r\n    new DataView(chunkSizeBuffer).setBigUint64(0, BigInt(chunk_size), true);\r\n    await file_writer(new Uint8Array(chunkSizeBuffer));\r\n\r\n    let total_bytes = 0; // \u7528\u4E8E\u7EDF\u8BA1\u603B\u5B57\u8282\u6570\r\n    let nonce_counter = 1;\r\n    let position = 0;\r\n\r\n    // \u5199\u5165iv\u53C2\u6570\r\n    const nonce_counter_start = new ArrayBuffer(8);\r\n    new DataView(nonce_counter_start).setBigUint64(0, BigInt(nonce_counter), true);\r\n    await file_writer(new Uint8Array(nonce_counter_start));\r\n\r\n    // \u5206\u5757\u52A0\u5BC6\u5904\u7406\r\n    callback?.(0);\r\n    const cryptoKey = await crypto.subtle.importKey('raw', derived_key, { name: 'AES-GCM' }, false, ['encrypt']);\r\n    while (true) {\r\n        // \u8BFB\u53D6\u6587\u4EF6\u5757\r\n        const chunk = await file_reader(position, position + chunk_size);\r\n        // chunk should be a Uint8Array\r\n        if (!(chunk instanceof Uint8Array)) throw new Exceptions.BadDataException(\"The file chunk is not a Uint8Array.\");\r\n        if (chunk.length === 0) break;\r\n        const isFinalChunk = chunk.length < chunk_size;\r\n\r\n        // \u4E3A\u6BCF\u4E2A\u5206\u5757\u751F\u6210\u65B0IV (12\u5B57\u8282)\r\n        const iv = new ArrayBuffer(12);\r\n        // \u786E\u4FDD IV \u552F\u4E00\r\n        if (nonce_counter >= 2 ** 64 || nonce_counter >= Number.MAX_SAFE_INTEGER) {\r\n            throw new Exceptions.IVException(\"nonce_counter exceeded the maximum value.\");\r\n        }\r\n        new DataView(iv).setBigUint64(4, BigInt(nonce_counter), true); // \u5199\u51658\u5B57\u8282\u8BA1\u6570\u5668\r\n        nonce_counter++;\r\n\r\n        if (isFinalChunk) {\r\n            await file_writer(new Uint8Array(TAIL_BLOCK_MARKER));\r\n            // \u5199\u5165\u8BE5\u5206\u5757\u957F\u5EA6\r\n            const chunkLengthBuffer = new ArrayBuffer(8);\r\n            new DataView(chunkLengthBuffer).setBigUint64(0, BigInt(chunk.length), true);\r\n            await file_writer(new Uint8Array(chunkLengthBuffer));\r\n        }\r\n\r\n        // \u4F7F\u7528WebCrypto\u8FDB\u884C\u52A0\u5BC6\r\n        const ivArray = new Uint8Array(iv);\r\n        const ciphertext = await crypto.subtle.encrypt(\r\n            {\r\n                name: 'AES-GCM',\r\n                iv: ivArray,\r\n            },\r\n            cryptoKey,\r\n            chunk\r\n        );\r\n\r\n        // \u5199\u5165\u5206\u5757\u4FE1\u606F: \u5BC6\u6587 + tag(16\u5B57\u8282)\r\n        // \u5BC6\u6587\u7684\u957F\u5EA6\u548C\u539F\u6587\u76F8\u540C\r\n        const ciphertextArray = new Uint8Array(ciphertext);\r\n        await file_writer(ciphertextArray);\r\n\r\n        total_bytes += chunk.length;\r\n        position += chunk.length;\r\n\r\n        callback?.(total_bytes);\r\n    }\r\n\r\n    // \u5199\u5165\u7ED3\u675F\u6807\u8BB0\u548C\u603B\u5B57\u8282\u6570\r\n    await file_writer(new Uint8Array(END_MARKER));\r\n\r\n    const totalBytesBuffer = new ArrayBuffer(8);\r\n    new DataView(totalBytesBuffer).setBigUint64(0, BigInt(total_bytes), true);\r\n    await file_writer(new Uint8Array(totalBytesBuffer));\r\n    await file_writer(new Uint8Array(FILE_END_MARKER));\r\n\r\n    return true;\r\n}\r\n\r\n/**\r\n * \u89E3\u5BC6\u6587\u4EF6\uFF081.1\uFF09\r\n * @deprecated \u4EC5\u4F9B\u517C\u5BB91.1\u7248\u672C\u4F7F\u7528\u3002\r\n * @param {Function} file_reader - \u6587\u4EF6\u8BFB\u53D6\u5668\u5BF9\u8C61\uFF0C\u9700\u8981\u5B9E\u73B0(start, end) => Promise<Uint8Array>\r\n * @param {Function} file_writer - \u6587\u4EF6\u5199\u5165\u5668\u5BF9\u8C61\uFF0C\u9700\u8981\u5B9E\u73B0write(Uint8Array)\u65B9\u6CD5\r\n * @param {string} user_key - \u7528\u6237\u63D0\u4F9B\u7684\u89E3\u5BC6\u5BC6\u94A5\r\n * @param {Function} [callback=null] - \u8FDB\u5EA6\u56DE\u8C03\u51FD\u6570\r\n * @returns {Promise<boolean>} \u8FD4\u56DE\u89E3\u5BC6\u662F\u5426\u6210\u529F\r\n */\r\nexport async function decrypt_file_V_1_1_0(file_reader, file_writer, user_key, callback = null) {\r\n    // \u8BFB\u53D6\u6587\u4EF6\u5934\u5E76\u9A8C\u8BC1\r\n    const header = await file_reader(0, 16);\r\n    if (str_decode(header) !== 'MyEncryption/1.1') {\r\n        throw new TypeError(\"Invalid file format\");\r\n    }\r\n    let read_pos = 16;\r\n\r\n    // \u8BFB\u53D6\u4E3B\u5BC6\u94A5\u5BC6\u6587\u957F\u5EA6\r\n    const ekey_len_bytes = await file_reader(read_pos, read_pos + 4);\r\n    const ekey_len = new DataView(ekey_len_bytes.buffer).getUint32(0, true);\r\n    read_pos += 4;\r\n\r\n    // \u8BFB\u53D6\u4E3B\u5BC6\u94A5\u5BC6\u6587\u5E76\u8DF3\u8FC7\u586B\u5145\r\n    const ekey = str_decode(await file_reader(read_pos, read_pos + ekey_len));\r\n    read_pos += 1024; // \u76F4\u63A5\u8DF3\u8FC71024\u5B57\u8282\u533A\u57DF\r\n\r\n    // \u89E3\u5BC6\u4E3B\u5BC6\u94A5\r\n    const key = await decrypt_data(ekey, user_key);\r\n\r\n    // \u8BFB\u53D6\u5934\u90E8JSON\u957F\u5EA6\r\n    const json_len_bytes = await file_reader(read_pos, read_pos + 4);\r\n    const json_len = new DataView(json_len_bytes.buffer).getUint32(0, true);\r\n    read_pos += 4;\r\n\r\n    // \u89E3\u6790\u5934\u90E8JSON\r\n    const header_json = JSON.parse(\r\n        str_decode(await file_reader(read_pos, read_pos + json_len))\r\n    );\r\n    read_pos += json_len;\r\n\r\n    // \u63D0\u53D6\u6D3E\u751F\u53C2\u6570\r\n    const [phrase, salt_hex] = header_json.parameter.split(':');\r\n    const salt = unhexlify(salt_hex);\r\n    const iv4key = unhexlify(header_json.iv);\r\n    const N = header_json.N;\r\n\r\n    // \u5BF9\u5E94\u52A0\u5BC6\u65F6\uFF0C\u9700\u8981\u63D0\u4F9B\u4E00\u4E2Aiv\uFF0C\u6211\u4EEC\u628Aiv\u53D6\u56DE\u6765\uFF0C\u91CD\u65B0\u751F\u6210\u5BC6\u94A5\uFF08\u6240\u6709\u6570\u636E\u5757\u7684\u5BC6\u94A5\u662F\u76F8\u540C\u7684\uFF09\r\n    callback?.(0);\r\n    await nextTick();\r\n    const { derived_key } = await derive_key(key, iv4key, phrase, N, salt);\r\n\r\n    let total_bytes = 0;\r\n    // \u5206\u5757\u89E3\u5BC6\u5FAA\u73AF\r\n    const cryptoKey = await crypto.subtle.importKey('raw', derived_key, { name: 'AES-GCM' }, false, ['decrypt']);\r\n    while (true) {\r\n        // \u8BFB\u53D6\u5206\u5757\u957F\u5EA6\u6807\u8BB0\r\n        const chunk_len_bytes = await file_reader(read_pos, read_pos + 8);\r\n        read_pos += 8;\r\n\r\n        // \u68C0\u67E5\u7ED3\u675F\u6807\u8BB0\r\n        if (chunk_len_bytes.every((v, i) =>\r\n            v === [0xFF, 0xFD, 0xF0, 0x10, 0x13, 0xD0, 0x12, 0x18][i]\r\n        )) break;\r\n\r\n        // \u89E3\u6790\u5206\u5757\u957F\u5EA6\r\n        const chunk_len = Number(\r\n            new DataView(chunk_len_bytes.buffer).getBigUint64(0, true)\r\n        );\r\n\r\n        // \u8BFB\u53D6IV(12\u5B57\u8282)\u3001\u5BC6\u6587\u548Ctag(16\u5B57\u8282)\r\n        const iv = await file_reader(read_pos, read_pos + 12);\r\n        read_pos += 12;\r\n        const ciphertext = await file_reader(read_pos, read_pos + chunk_len + 16);\r\n        read_pos += chunk_len + 16;\r\n\r\n        const full_ciphertext = ciphertext;\r\n\r\n        // \u4F7F\u7528WebCrypto\u89E3\u5BC6\r\n        const decrypted = await crypto.subtle.decrypt(\r\n            {\r\n                name: 'AES-GCM',\r\n                iv: iv,\r\n            },\r\n            cryptoKey,\r\n            full_ciphertext\r\n        );\r\n\r\n        // \u5199\u5165\u89E3\u5BC6\u540E\u7684\u6570\u636E\r\n        await file_writer(new Uint8Array(decrypted));\r\n        total_bytes += decrypted.byteLength;\r\n        if (callback) callback(total_bytes);\r\n    }\r\n\r\n    // \u9A8C\u8BC1\u603B\u5B57\u8282\u6570\u548C\u7ED3\u675F\u6807\u8BB0\r\n    const total_bytes_bytes = await file_reader(read_pos, read_pos + 8);\r\n    const total_bytes_decrypted = Number(\r\n        new DataView(total_bytes_bytes.buffer).getBigUint64(0, true)\r\n    );\r\n    read_pos += 8;\r\n\r\n    const end_marker = await file_reader(read_pos, read_pos + 2);\r\n    if (total_bytes !== total_bytes_decrypted) throw new Exceptions.FileCorruptedException(\"File corrupted: total bytes mismatch\")\r\n    if (!end_marker.every((v, i) => v === [0x55, 0xAA][i])) throw new Exceptions.InvalidEndMarkerException(\"Invalid end marker\");\r\n\r\n    return true;\r\n}\r\n/**\r\n * \u89E3\u5BC6\u6587\u4EF6\r\n * @param {Function} file_reader - \u6587\u4EF6\u8BFB\u53D6\u5668\u5BF9\u8C61\uFF0C\u9700\u8981\u5B9E\u73B0(start, end) => Promise<Uint8Array>\r\n * @param {Function} file_writer - \u6587\u4EF6\u5199\u5165\u5668\u5BF9\u8C61\uFF0C\u9700\u8981\u5B9E\u73B0write(Uint8Array)\u65B9\u6CD5\r\n * @param {string} user_key - \u7528\u6237\u63D0\u4F9B\u7684\u89E3\u5BC6\u5BC6\u94A5\r\n * @param {Function} [callback=null] - \u8FDB\u5EA6\u56DE\u8C03\u51FD\u6570\r\n * @returns {Promise<boolean>} \u8FD4\u56DE\u89E3\u5BC6\u662F\u5426\u6210\u529F\r\n */\r\nexport async function decrypt_file(file_reader, file_writer, user_key, callback = null) {\r\n    // \u8BFB\u53D6\u6587\u4EF6\u5934\u5E76\u9A8C\u8BC1\r\n    const header = await file_reader(0, 13);\r\n    if (str_decode(header) !== 'MyEncryption/') {\r\n        throw new Exceptions.InvalidFileFormatException();\r\n    }\r\n    const top_header_version = (str_decode(await file_reader(13, 16)));\r\n    if(!(['1.1', '1.2'].includes(top_header_version))) {\r\n        throw new Exceptions.EncryptionVersionMismatchException();\r\n    }\r\n    const version_marker = new DataView((await file_reader(16, 20)).buffer).getUint32(0, true);\r\n    const version = normalize_version(top_header_version, version_marker);\r\n    let read_pos = 16 + 4;\r\n\r\n    if (version === ENCRYPTION_FILE_VER_1_1_0) {\r\n        return await decrypt_file_V_1_1_0(file_reader, file_writer, user_key, callback);\r\n    }\r\n\r\n    const ekey_len = new DataView((await file_reader(read_pos, read_pos + 4)).buffer).getUint32(0, true);\r\n    const ekey = str_decode(await file_reader(read_pos + 4, read_pos + 4 + ekey_len));\r\n\r\n    read_pos += PADDING_SIZE;\r\n    \r\n    if (ekey_len > PADDING_SIZE) {\r\n        throw new Exceptions.InternalError(\"(Internal Error) This should not happen. Contact the application developer.\");\r\n    }\r\n        \r\n    // \u89E3\u5BC6\u4E3B\u5BC6\u94A5\r\n    const key = await decrypt_data(ekey, user_key);\r\n\r\n    // \u8BFB\u53D6\u5934\u90E8JSON\u957F\u5EA6\r\n    const json_len_bytes = await file_reader(read_pos, read_pos + 4);\r\n    const json_len = new DataView(json_len_bytes.buffer).getUint32(0, true);\r\n    read_pos += 4;\r\n\r\n    // \u89E3\u6790\u5934\u90E8JSON\r\n    const header_json = JSON.parse(\r\n        str_decode(await file_reader(read_pos, read_pos + json_len))\r\n    );\r\n    read_pos += json_len;\r\n\r\n    // \u63D0\u53D6\u6D3E\u751F\u53C2\u6570\r\n    const header_version = header_json.v;\r\n    if (!([5.5].includes(header_version))) throw new Exceptions.EncryptionVersionMismatchException();\r\n    const [phrase, salt_hex] = header_json.parameter.split(':');\r\n    const salt = unhexlify(salt_hex);\r\n    const iv4key = unhexlify(header_json.iv);\r\n    const N = header_json.N;\r\n\r\n    // \u83B7\u53D6chunk size\u548Civ\u53C2\u6570\r\n    const chunk_size = Number(new DataView((await file_reader(read_pos, read_pos + 8)).buffer).getBigUint64(0, true));\r\n    let nonce_counter = Number(new DataView((await file_reader(read_pos + 8, read_pos + 16)).buffer).getBigUint64(0, true));\r\n    read_pos += 16;\r\n\r\n    // \u5BF9\u5E94\u52A0\u5BC6\u65F6\uFF0C\u9700\u8981\u63D0\u4F9B\u4E00\u4E2Aiv\uFF0C\u6211\u4EEC\u628Aiv\u53D6\u56DE\u6765\uFF0C\u91CD\u65B0\u751F\u6210\u5BC6\u94A5\uFF08\u6240\u6709\u6570\u636E\u5757\u7684\u5BC6\u94A5\u662F\u76F8\u540C\u7684\uFF09\r\n    callback?.(0);\r\n    await nextTick();\r\n    const { derived_key } = await derive_key(key, iv4key, phrase, N, salt);\r\n\r\n    let total_bytes = 0, is_final_chunk = false;\r\n    // \u5206\u5757\u89E3\u5BC6\u5FAA\u73AF\r\n    const cryptoKey = await crypto.subtle.importKey('raw', derived_key, { name: 'AES-GCM' }, false, ['decrypt']);\r\n    while (true) {\r\n        // \u8BFB\u53D6\u5206\u5757\u957F\u5EA6\u6807\u8BB0\r\n        const chunk_tag = await file_reader(read_pos, read_pos + 8);\r\n\r\n        // \u68C0\u67E5\u7ED3\u675F\u6807\u8BB0\r\n        let real_size = 0;\r\n        if ((chunk_tag).every((v, i) => v === END_IDENTIFIER[i])) {\r\n            const full_bytes = await file_reader(read_pos, read_pos + 32); // \u8BFB\u53D6\u5B8C\u6574\u6807\u8BB0\r\n            if (full_bytes.every((v, i) => v === END_MARKER[i])) {\r\n                read_pos += 32; // \u8DF3\u8FC7\u6807\u8BB0\r\n                break;\r\n            }\r\n            if (full_bytes.every((v, i) => v === TAIL_BLOCK_MARKER[i])) {\r\n                is_final_chunk = true;\r\n                read_pos += 32; // \u8DF3\u8FC7\u6807\u8BB0\r\n                // \u8BFB\u53D6\u5206\u5757\u957F\u5EA6\r\n                const chunk_len_bytes = await file_reader(read_pos, read_pos + 8);\r\n                read_pos += 8;\r\n                real_size = Number(new DataView(chunk_len_bytes.buffer).getBigUint64(0, true));\r\n                if (real_size === 0) break; // \u8BFB\u53D6\u52300\u5B57\u8282\uFF0C\u7ED3\u675F\u5FAA\u73AF\r\n            }\r\n        }\r\n\r\n        // \u89E3\u6790\u5206\u5757\u957F\u5EA6\uFF08\u4E0D\u5305\u62EC16\u5B57\u8282\u6807\u7B7E\uFF09\r\n        const ciphertext_length = (is_final_chunk ? real_size : chunk_size)\r\n\r\n        // \u83B7\u53D6iv\r\n        const iv_array = new ArrayBuffer(12);\r\n        new DataView(iv_array).setBigUint64(4, BigInt(nonce_counter), true);\r\n        nonce_counter++;\r\n        \r\n        // \u8BFB\u53D6\u5BC6\u6587\u548Ctag(16\u5B57\u8282)\r\n        const ciphertext = await file_reader(read_pos, read_pos + ciphertext_length + 16);\r\n        read_pos += ciphertext_length + 16;\r\n\r\n        const full_ciphertext = ciphertext;\r\n\r\n        // \u4F7F\u7528WebCrypto\u89E3\u5BC6\r\n        try {\r\n            const decrypted = await crypto.subtle.decrypt(\r\n                {\r\n                    name: 'AES-GCM',\r\n                    iv: new Uint8Array(iv_array),\r\n                },\r\n                cryptoKey,\r\n                full_ciphertext\r\n            );\r\n\r\n            // \u5199\u5165\u89E3\u5BC6\u540E\u7684\u6570\u636E\r\n            await file_writer(new Uint8Array(decrypted));\r\n            total_bytes += decrypted.byteLength;\r\n        } catch (e) {\r\n            if (!e) throw new Exceptions.InternalError(`Internal error.`, { cause: e });\r\n            const name = e.name;\r\n            if (name === 'InvalidAccessError') throw new Exceptions.InvalidParameterException('InvalidAccessError.', { cause: e });\r\n            if (name === 'OperationError') throw new Exceptions.CannotDecryptException('Cannot decrypt. Did you provide the correct password?', { cause: e });\r\n            if (!e) throw new Exceptions.InternalError(`Unexpected error.`, { cause: e });\r\n        }\r\n        if (callback) callback(total_bytes);\r\n    }\r\n\r\n    // \u9A8C\u8BC1\u603B\u5B57\u8282\u6570\u548C\u7ED3\u675F\u6807\u8BB0\r\n    const total_bytes_bytes = await file_reader(read_pos, read_pos + 8);\r\n    const total_bytes_decrypted = Number(\r\n        new DataView(total_bytes_bytes.buffer).getBigUint64(0, true)\r\n    );\r\n    read_pos += 8;\r\n\r\n    const end_marker = await file_reader(read_pos, read_pos + FILE_END_MARKER.length);\r\n    if (total_bytes !== total_bytes_decrypted) throw new Exceptions.FileCorruptedException(\"total bytes mismatch\")\r\n    if (!end_marker.every((v, i) => v === FILE_END_MARKER[i])) throw new Exceptions.InvalidEndMarkerException();\r\n\r\n    return true;\r\n}\r\n", "// @ts-nocheck\r\nimport { str_encode, str_decode } from \"./str.js\";\r\nimport { encrypt_data, decrypt_data } from \"./encrypt_data.js\";\r\nimport { PADDING_SIZE, normalize_version, ENCRYPTION_FILE_VER_1_1_0, ENCRYPTION_FILE_VER_1_2_10020 } from \"./encrypt_file.js\";\r\nimport * as Exceptions from './exceptions.js';\r\n\r\n\r\n/**\r\n * Export the file's master key.\r\n * @param {Blob} file_head File header. Recommended to provide 5KB. At least provide 1044 bytes(V1.1) or .\r\n * @param {String} current_key current file password\r\n * @param {String} export_key The password to protect the master key\r\n * @returns String exported key\r\n */\r\nexport async function export_master_key(file_head, current_key, export_key) {\r\n    if (file_head.size < (1024 + 16 + 4)) throw new Exceptions.BadDataException('Data not enough');\r\n\r\n    // Verify file header\r\n    const headerBlob = file_head.slice(0, 13);\r\n    const header = await headerBlob.text();\r\n    if (header !== \"MyEncryption/\") {\r\n        throw new Exceptions.InvalidFileFormatException();\r\n    }\r\n    const top_header_version = await (file_head.slice(13, 16)).text();\r\n    if(!(['1.1', '1.2'].includes(top_header_version))) {\r\n        throw new Exceptions.EncryptionVersionMismatchException();\r\n    }\r\n    const version_marker = new DataView((await file_head.slice(16, 20).arrayBuffer())).getUint32(0, true);\r\n    const version = normalize_version(top_header_version, version_marker);\r\n\r\n    if (version === ENCRYPTION_FILE_VER_1_1_0) {\r\n        // Read encrypted master key length and ciphertext\r\n        const ekey_len = new DataView(await file_head.slice(16, 20).arrayBuffer()).getUint32(0, true);\r\n        const buffer = await file_head.slice(20, 20 + ekey_len).arrayBuffer();\r\n        const ekey_ciphertext = str_decode(buffer);\r\n        // Decrypt master key with current_key and re-encrypt with export_key\r\n        return await encrypt_data(await decrypt_data(ekey_ciphertext, current_key), export_key);\r\n    }\r\n\r\n    if (version === ENCRYPTION_FILE_VER_1_2_10020) {\r\n        if (file_head.size < 16 + PADDING_SIZE) throw new Exceptions.BadDataException('Data not enough');\r\n        const ekey_len = new DataView(await file_head.slice(20, 24).arrayBuffer()).getUint32(0, true);\r\n        const buffer = await file_head.slice(24, 24 + ekey_len).arrayBuffer();\r\n        const ekey_ciphertext = str_decode(buffer);\r\n        // Decrypt master key with current_key and re-encrypt with export_key\r\n        return await encrypt_data(await decrypt_data(ekey_ciphertext, current_key), export_key);\r\n    }\r\n\r\n    throw new Exceptions.EncryptionVersionMismatchException();\r\n}\r\n\r\n\r\n\r\nasync function change_file_password_1_1_0(file_head, current_key, new_key) {\r\n    if (file_head.size < (1024 + 16 + 4)) throw new Error('Data not enough');\r\n\r\n    // Verify file header\r\n    const headerBlob = file_head.slice(0, 16);\r\n    const header = await headerBlob.text();\r\n    if (header !== \"MyEncryption/1.1\") {\r\n        throw new TypeError(\"Invalid file format\");\r\n    }\r\n\r\n    // Read encrypted master key length and ciphertext\r\n    const ekey_len = new DataView(await file_head.slice(16, 20).arrayBuffer()).getUint32(0, true);\r\n    const ekey_ciphertext = str_decode(await file_head.slice(20, 20 + ekey_len).arrayBuffer());\r\n\r\n    // Decrypt master key with current_key and re-encrypt with export_key\r\n    const new_ekey = await encrypt_data(await decrypt_data(ekey_ciphertext, current_key), new_key);\r\n    // Check length\r\n    if (new_ekey.length > 1024) {\r\n        throw new Error(\"(Internal Error) This should not happen. Contact the application developer.\");\r\n    }\r\n    const new_ekey_len = new_ekey.length;\r\n    const new_ekey_len_bytes = new ArrayBuffer(4);\r\n    const new_ekey_len_view = new DataView(new_ekey_len_bytes);\r\n    new_ekey_len_view.setUint32(0, new_ekey_len, true);\r\n\r\n    const new_ekey_parts = [headerBlob, new_ekey_len_bytes, str_encode(new_ekey)];\r\n    const padding = new Uint8Array(1024 - new_ekey.length).fill(0);\r\n    new_ekey_parts.push(padding);\r\n\r\n    return new Blob(new_ekey_parts);\r\n}\r\n/**\r\n * Change file password\r\n * note: \u4E0D\u5EFA\u8BAE\u5728web\u7AEF\u66F4\u6539\u5BC6\u7801\u3002\u7531\u4E8E\u6D4F\u89C8\u5668\u5199\u5165\u6587\u4EF6\u7684\u5DE5\u4F5C\u539F\u7406\uFF08https://developer.mozilla.org/zh-CN/docs/Web/API/FileSystemFileHandle/createWritable \uFF09\r\n * \u4EFB\u4F55\u901A\u8FC7\u5199\u5165\u6D41\u9020\u6210\u7684\u66F4\u6539\u5728\u5199\u5165\u6D41\u88AB\u5173\u95ED\u524D\u90FD\u4E0D\u4F1A\u53CD\u6620\u5230\u6587\u4EF6\u53E5\u67C4\u6240\u4EE3\u8868\u7684\u6587\u4EF6\u4E0A\u3002\u8FD9\u901A\u5E38\u662F\u5C06\u6570\u636E\u5199\u5165\u5230\u4E00\u4E2A\u4E34\u65F6\u6587\u4EF6\u6765\u5B9E\u73B0\u7684\uFF0C\u7136\u540E\u53EA\u6709\u5728\u5199\u5165\u6587\u4EF6\u6D41\u88AB\u5173\u95ED\u540E\u624D\u4F1A\u7528\u4E34\u65F6\u6587\u4EF6\u66FF\u6362\u6389\u6587\u4EF6\u53E5\u67C4\u6240\u4EE3\u8868\u7684\u6587\u4EF6\u3002\r\n * \u4E5F\u5C31\u662F\u8BF4\uFF0C\u65E7\u5BC6\u7801\u5C06\u59CB\u7EC8\u5B58\u5728\u4E8E\u78C1\u76D8\u4E0A\u3002\u8FD9\u5C06\u5BFC\u81F4\u654F\u611F\u6570\u636E\u6CC4\u9732\u3002\r\n * \u53E6\u5916\uFF0C\u7531\u4E8E\u8FD9\u4E2A\u7279\u6027\uFF0C\u5927\u6587\u4EF6\u76F8\u5173\u64CD\u4F5C\u4F1A\u53D8\u5F97\u975E\u5E38\u975E\u5E38\u6162\u3002\r\n * \u6240\u4EE5\uFF0C\u9664\u975E\u7279\u6B8A\u60C5\u51B5\uFF0C\u52A1\u5FC5\u59CB\u7EC8\u4F7F\u7528 native \u5E94\u7528\u7A0B\u5E8F\u6765\u4FEE\u6539\u6587\u4EF6\u5BC6\u7801\r\n * @param {Blob} file_head File header. Recommended to provide 2KB. At least provide 1044 bytes.\r\n * @param {String} current_key current file password\r\n * @param {String} new_key The new password\r\n * @returns Blob The new file header. Note that the size of the new header differs from the original file. Do not use it to construct a new file. Instead, overwrite the original file header directly with the new header without offsetting the file.  \r\n * @throws {Error} If the file header is invalid or the file size is not enough.\r\n */\r\nexport async function change_file_password(file_head, current_key, new_key) {\r\n    if (file_head.size < (1024 + 16 + 4)) throw new Error('Data not enough');\r\n\r\n    // Verify file header\r\n    const headerBlob = file_head.slice(0, 13);\r\n    const header = await headerBlob.text();\r\n    if (header !== \"MyEncryption/\") {\r\n        throw new Exceptions.InvalidFileFormatException();\r\n    }\r\n    const top_header_version = await (file_head.slice(13, 16)).text();\r\n    if (!(['1.1', '1.2'].includes(top_header_version))) {\r\n        throw new Exceptions.EncryptionVersionMismatchException();\r\n    }\r\n    const version_marker = new DataView((await file_head.slice(16, 20).arrayBuffer())).getUint32(0, true);\r\n    const version = normalize_version(top_header_version, version_marker);\r\n\r\n    if (version === ENCRYPTION_FILE_VER_1_1_0) return await change_file_password_1_1_0(file_head, current_key, new_key);\r\n\r\n    // Read encrypted master key length and ciphertext\r\n    const ekey_len = new DataView(await file_head.slice(20, 24).arrayBuffer()).getUint32(0, true);\r\n    const ekey_ciphertext = str_decode(await file_head.slice(24, 24 + ekey_len).arrayBuffer());\r\n\r\n    // Decrypt master key with current_key and re-encrypt with export_key\r\n    const new_ekey = await encrypt_data(await decrypt_data(ekey_ciphertext, current_key), new_key);\r\n    // Check length\r\n    if (new_ekey.length > 1024) {\r\n        throw new Error(\"(Internal Error) This should not happen. Contact the application developer.\");\r\n    }\r\n    const new_ekey_len = new_ekey.length;\r\n    const new_ekey_len_bytes = new ArrayBuffer(4);\r\n    const new_ekey_len_view = new DataView(new_ekey_len_bytes);\r\n    new_ekey_len_view.setUint32(0, new_ekey_len, true);\r\n\r\n    const new_ekey_parts = [file_head.slice(0, 20), new_ekey_len_bytes, str_encode(new_ekey)];\r\n    const padding = new Uint8Array(PADDING_SIZE - new_ekey.length - 4).fill(0);\r\n    new_ekey_parts.push(padding);\r\n\r\n    return new Blob(new_ekey_parts);\r\n}", "import * as Exceptions from './exceptions.js';\r\n\r\nconst CRYPT_CONTEXT = Object.create(null);\r\nCRYPT_CONTEXT[Symbol.toStringTag] = 'CryptContext';\r\nCRYPT_CONTEXT['toString'] = function () {\r\n    return `${this[Symbol.toStringTag]} Object`;\r\n};\r\n\r\nexport { CRYPT_CONTEXT as CryptContext };\r\n\r\n/**\r\n * @param {any} PromiseLike\r\n */\r\nasync function _await(PromiseLike) {\r\n    if (PromiseLike instanceof Promise) return await PromiseLike;\r\n    return PromiseLike;\r\n}\r\n\r\nexport async function crypt_context_create() {\r\n    const ctx = Object.create(CRYPT_CONTEXT);\r\n    Object.defineProperty(ctx, '_created', { value: true });\r\n    return ctx;\r\n}\r\n\r\nexport async function crypt_context_destroy(ctx) {\r\n    if (!ctx || ctx._released) throw new Exceptions.InvalidParameterException(\"Invalid context\");\r\n    for (const i of Reflect.ownKeys(ctx)) {\r\n        if (typeof i === 'symbol') {\r\n            Reflect.deleteProperty(ctx, i);\r\n            continue;\r\n        }\r\n        const o = Reflect.get(ctx, i);\r\n        if (o) {\r\n            if (o.release) await _await(o.release());\r\n            else if (o.free) await _await(o.free());\r\n            else if (o.reset) await _await(o.reset());\r\n            else if (o.clear) await _await(o.clear());\r\n        }\r\n        if (!i.startsWith('_')) Reflect.deleteProperty(ctx, i);\r\n    }\r\n    Object.defineProperty(ctx, '_released', { value: true });\r\n    return true;\r\n}\r\n\r\n", "// streamed encryption\r\nimport { CryptContext } from \"./context.js\";\r\nimport * as Exceptions from './exceptions.js';\r\nimport { str_decode } from \"./str.js\";\r\nimport { derive_key } from \"./derive_key.js\";\r\nimport { unhexlify } from \"./binascii.js\";\r\nimport { decrypt_data } from \"./encrypt_data.js\";\r\nimport { normalize_version, PADDING_SIZE, END_IDENTIFIER, END_MARKER, TAIL_BLOCK_MARKER, ENCRYPTION_FILE_VER_1_2_10020, FILE_END_MARKER } from \"./encrypt_file.js\";\r\n\r\n\r\nexport class Stream {\r\n    #reader = null;\r\n    #cache = {\r\n        position: null,\r\n        end: null,\r\n        data: null,\r\n    };\r\n    #size = null;\r\n    get [Symbol.toStringTag]() {\r\n        return 'Stream';\r\n    }\r\n\r\n    /**\r\n     * @param {function(number, number, AbortSignal): Promise<Uint8Array>} reader The reader function\r\n     * @param {number} size The size of the stream\r\n     */\r\n    constructor(reader, size) {\r\n        if (typeof reader !== 'function') throw new Exceptions.InvalidParameterException('Stream: Invalid reader');\r\n        this.#reader = reader;\r\n        if (typeof size !== 'number') throw new Exceptions.InvalidParameterException('Stream: Invalid size');\r\n        this.#size = size;\r\n    }\r\n\r\n    get size() {\r\n        return this.#size;\r\n    }\r\n\r\n    /** @type {AbortController|null} */\r\n    #abort_controller = null;\r\n\r\n    /**\r\n     * Read a stream\r\n     * @param {Number} start start pos\r\n     * @param {Number} end end pos\r\n     * @param {Number|null} suggestion_end The suggested end. Used for caching.\r\n     * @param {AbortController|null} abort The abort controller. Used for aborting the read.\r\n     * @returns {Promise<Uint8Array>}\r\n     */\r\n    async read(start, end, suggestion_end = null, abort = null) {\r\n        if (!this.#reader) throw new Error('Stream: The stream has been closed.');\r\n        if (this.#cache.position != null && this.#cache.end && this.#cache.data && (start >= this.#cache.position && end <= this.#cache.end)) {\r\n            // cache match\r\n            return this.#cache.data.slice(start - this.#cache.position, end - this.#cache.position);\r\n        }\r\n\r\n        // normalize parameters\r\n        if (start < 0) throw new Exceptions.InvalidParameterException('Stream: Invalid start position');\r\n        if (end > this.#size) end = this.#size;\r\n        if (suggestion_end > this.#size) suggestion_end = this.#size;\r\n\r\n        this.#abort_controller = abort;\r\n        if (suggestion_end) {\r\n            // cache policy\r\n            const data = await this.#reader(start, suggestion_end, abort?.signal);\r\n            this.#abort_controller = null;\r\n            // save cache\r\n            this.#cache.position = start;\r\n            this.#cache.end = start + data.length;\r\n            this.#cache.data = (data);\r\n            // return data\r\n            return data.slice(0, end - start);\r\n        }\r\n        // cache mismatch\r\n        const data = await this.#reader(start, end, abort?.signal);\r\n        this.#abort_controller = null;\r\n        return data;\r\n    }\r\n\r\n    abort() {\r\n        this.#abort_controller?.abort();\r\n    }\r\n\r\n    purge() {\r\n        this.#cache.position = this.#cache.data = this.#cache.end = null;\r\n    }\r\n\r\n    close() {\r\n        this.#reader = null;\r\n        this.purge();\r\n    }\r\n};\r\n\r\n\r\n/**\r\n * Prepare for a stream decryption.\r\n * @param {CryptContext} ctx Context\r\n * @param {Stream} stream The stream to decrypt.\r\n * @param {String} password The password.\r\n * @param {Object} [param3={}] Options.\r\n * @param {boolean} [param3.cache=true] Set if the cache is enabled.\r\n * @param {number} [param3.cache_max_size=256 * 1024 * 1024] Set the maximium size of the cache.\r\n */\r\nexport async function decrypt_stream_init(ctx, stream, password, {\r\n    cache = true,\r\n    cache_max_size = 256 * 1024 * 1024,\r\n} = {}) {\r\n    if (ctx._inited) throw new Exceptions.CryptContextReusedException();\r\n    Object.defineProperty(ctx, '_inited', { value: true });\r\n\r\n    ctx._type = '@decrypt_stream';\r\n    ctx.stream = {\r\n        stream: stream,\r\n        release: () => ctx.stream.stream.close(),\r\n    };\r\n\r\n    // \u6D3E\u751F\u5BC6\u94A5\r\n    const header = await stream.read(0, 13, 5000);\r\n    if (str_decode(header) !== 'MyEncryption/') {\r\n        throw new Exceptions.InvalidFileFormatException();\r\n    }\r\n    const top_header_version = (str_decode(await stream.read(13, 16)));\r\n    if(!(['1.1', '1.2'].includes(top_header_version))) {\r\n        throw new Exceptions.EncryptionVersionMismatchException();\r\n    }\r\n    const version_marker = new DataView((await stream.read(16, 20)).buffer).getUint32(0, true);\r\n    const version = normalize_version(top_header_version, version_marker);\r\n    let read_pos = 16 + 4;\r\n\r\n    if (version !== ENCRYPTION_FILE_VER_1_2_10020) {\r\n        throw new Exceptions.NotSupportedException(\"Cannot perform a streamed decryption on V1.1 files\");\r\n    }\r\n\r\n    const ekey_len = new DataView((await stream.read(read_pos, read_pos + 4)).buffer).getUint32(0, true);\r\n    const ekey = str_decode(await stream.read(read_pos + 4, read_pos + 4 + ekey_len));\r\n\r\n    read_pos += PADDING_SIZE;\r\n    \r\n    if (ekey_len > PADDING_SIZE) {\r\n        throw new Exceptions.InternalError(\"(Internal Error) This should not happen. Contact the application developer.\");\r\n    }\r\n        \r\n    // \u89E3\u5BC6\u4E3B\u5BC6\u94A5\r\n    const key = await decrypt_data(ekey, password);\r\n\r\n    // \u8BFB\u53D6\u5934\u90E8JSON\u957F\u5EA6\r\n    const json_len_bytes = await stream.read(read_pos, read_pos + 4);\r\n    const json_len = new DataView(json_len_bytes.buffer).getUint32(0, true);\r\n    read_pos += 4;\r\n\r\n    // \u89E3\u6790\u5934\u90E8JSON\r\n    const header_json = JSON.parse(\r\n        str_decode(await stream.read(read_pos, read_pos + json_len))\r\n    );\r\n    read_pos += json_len;\r\n\r\n    // \u63D0\u53D6\u6D3E\u751F\u53C2\u6570\r\n    const header_version = header_json.v;\r\n    if (!([5.5].includes(header_version))) throw new Exceptions.EncryptionVersionMismatchException();\r\n    const [phrase, salt_hex] = header_json.parameter.split(':');\r\n    const salt = unhexlify(salt_hex);\r\n    const iv4key = unhexlify(header_json.iv);\r\n    const N = header_json.N;\r\n\r\n    // \u83B7\u53D6chunk size\u548Civ\u53C2\u6570\r\n    const chunk_size = Number(new DataView((await stream.read(read_pos, read_pos + 8)).buffer).getBigUint64(0, true));\r\n    let nonce_counter = Number(new DataView((await stream.read(read_pos + 8, read_pos + 16)).buffer).getBigUint64(0, true));\r\n    read_pos += 16;\r\n\r\n    // \u5BF9\u5E94\u52A0\u5BC6\u65F6\uFF0C\u9700\u8981\u63D0\u4F9B\u4E00\u4E2Aiv\uFF0C\u6211\u4EEC\u628Aiv\u53D6\u56DE\u6765\uFF0C\u91CD\u65B0\u751F\u6210\u5BC6\u94A5\uFF08\u6240\u6709\u6570\u636E\u5757\u7684\u5BC6\u94A5\u662F\u76F8\u540C\u7684\uFF09\r\n    const { derived_key } = await derive_key(key, iv4key, phrase, N, salt);\r\n    const cryptoKey = await crypto.subtle.importKey('raw', derived_key, { name: 'AES-GCM' }, false, ['decrypt']);\r\n\r\n    ctx.key = cryptoKey;\r\n    ctx.chunk_size = chunk_size;\r\n    ctx.nonce_counter = nonce_counter;\r\n    ctx.header_json_length = json_len;\r\n    ctx.cache_enabled = !!cache;\r\n    ctx.cached_chunks = new Map();\r\n    ctx.cached_chunks_add_order = new Array();\r\n    ctx.cached_size = 0;\r\n    ctx.cache_max_size = cache_max_size;\r\n\r\n    return true;\r\n}\r\n\r\n\r\n/**\r\n * Decrypt a stream.\r\n * @param {CryptContext} ctx Context\r\n * @param {Number} bytes_start The start byte to decrypt\r\n * @param {Number} bytes_end The end byte to decrypt\r\n * @param {AbortController|null} abort The abort controller.\r\n * @returns {Promise<Blob>} The decrypted data, stored in a Blob object.\r\n */\r\nexport async function decrypt_stream(ctx, bytes_start, bytes_end, abort) {\r\n    if (!ctx._inited) throw new Exceptions.CryptContextNotInitedException();\r\n    if (ctx._type !== '@decrypt_stream') throw new Exceptions.InvalidCryptContextTypeException(ctx._type);\r\n    if (ctx._released) throw new Exceptions.CryptContextReleasedException();\r\n\r\n    /** @type {Stream} */\r\n    const stream = ctx.stream.stream;\r\n    const chunk_size = ctx.chunk_size;\r\n    const nonce_counter_start = ctx.nonce_counter;\r\n    const result = [];\r\n    \r\n    // \u6587\u4EF6\u593416 + \u7248\u672C\u6807\u8BC64 + \u4E3B\u5BC6\u94A54096 + JSON\u957F\u5EA64 + JSON + chunk_size8 + IV8\r\n    const chunks_start = 16 + 4 + PADDING_SIZE + 4 + ctx.header_json_length + 8 + 8;\r\n    // tag 16\u5B57\u8282\r\n    const size_per_chunk = chunk_size + 16;\r\n\r\n    // \u786E\u5B9A\u9700\u8981\u89E3\u5BC6\u7684\u5206\u5757\u4F4D\u7F6E\r\n    const max_chunk = Math.floor((stream.size - chunks_start - (32 + 8 + 32 + 8 + FILE_END_MARKER.length)) / size_per_chunk);\r\n    const start_chunk = Math.max(0, Math.floor(bytes_start / chunk_size));\r\n    const end_chunk = Math.min(max_chunk, Math.floor(bytes_end / chunk_size));\r\n    if (end_chunk < 0 || start_chunk > max_chunk) throw new Exceptions.InvalidParameterException(\"Out of range\")\r\n\r\n    // \u7528\u4E8E\u8BFB\u53D6chunk\r\n    const read_chunk = async (chunk) => {\r\n        // \u68C0\u67E5\u7F13\u5B58\r\n        if (ctx.cache_enabled && ctx.cached_chunks.has(chunk)) {\r\n            return ctx.cached_chunks.get(chunk);\r\n        }\r\n\r\n        // \u5B9A\u4F4D\u5BF9\u5E94chunk\r\n        let pos = chunks_start + (chunk * size_per_chunk);\r\n        // \u8BFB\u53D68\u5B57\u8282\r\n        const eight_bytes = await stream.read(pos, pos + 8, pos + (2 * size_per_chunk), abort);\r\n        // \u5224\u65AD\u662F\u5426\u7279\u6B8A\u60C5\u51B5\r\n        let real_size = 0;\r\n        if ((eight_bytes).every((v, i) => v === END_IDENTIFIER[i])) {\r\n            const full_bytes = await stream.read(pos, pos + 32, null, abort); // \u8BFB\u53D6\u5B8C\u6574\u6807\u8BB0\r\n            pos += 32;\r\n            // \u5224\u65AD\u662F\u5426\u7ED3\u675F\r\n            if (full_bytes.every((v, i) => v === END_MARKER[i])) {\r\n                return false\r\n            }\r\n            if (full_bytes.every((v, i) => v === TAIL_BLOCK_MARKER[i])) {\r\n                // \u8BFB\u53D6\u5206\u5757\u957F\u5EA6\r\n                const chunk_len_bytes = await stream.read(pos, pos + 8, null, abort);\r\n                pos += 8;\r\n                real_size = Number(new DataView(chunk_len_bytes.buffer).getBigUint64(0, true));\r\n                if (real_size === 0) return false // \u8BFB\u53D6\u52300\u5B57\u8282\uFF0C\u7ED3\u675F\u5FAA\u73AF\r\n            }\r\n        }\r\n\r\n        // \u8BFB\u53D6\r\n        const ciphertext_length = (real_size ? real_size : chunk_size)\r\n        const ciphertext = await stream.read(pos, pos + ciphertext_length + 16, null, abort);\r\n        // \u83B7\u53D6iv\r\n        const nonce_counter = nonce_counter_start + chunk;\r\n        const iv_array = new ArrayBuffer(12);\r\n        new DataView(iv_array).setBigUint64(4, BigInt(nonce_counter), true);\r\n\r\n        // \u4F7F\u7528WebCrypto\u89E3\u5BC6\r\n        try {\r\n            const data = await crypto.subtle.decrypt(\r\n                {\r\n                    name: 'AES-GCM',\r\n                    iv: new Uint8Array(iv_array),\r\n                },\r\n                ctx.key,\r\n                ciphertext\r\n            );\r\n            // \u4FDD\u5B58\u5230\u7F13\u5B58\r\n            if (ctx.cache_enabled) {\r\n                if (data.byteLength < ctx.cache_max_size) {\r\n                    ctx.cached_chunks_add_order.push(chunk);\r\n                    ctx.cached_chunks.set(chunk, data);\r\n                    ctx.cached_size += data.byteLength;\r\n                }\r\n\r\n                // \u68C0\u67E5\u7F13\u5B58\u5927\u5C0F\r\n                while (ctx.cached_size > ctx.cache_max_size) {\r\n                    const oldest_chunk = ctx.cached_chunks_add_order.shift();\r\n                    ctx.cached_size -= ctx.cached_chunks.get(oldest_chunk).byteLength;\r\n                    ctx.cached_chunks.delete(oldest_chunk);\r\n                }\r\n            }\r\n            return data;\r\n        }\r\n        catch (e) {\r\n            if (!e) throw new Exceptions.InternalError(`Internal error.`, { cause: e });\r\n            const name = e.name;\r\n            if (name === 'InvalidAccessError') throw new Exceptions.InvalidParameterException('InvalidAccessError.', { cause: e });\r\n            if (name === 'OperationError') throw new Exceptions.CannotDecryptException('Cannot decrypt. Did you provide the correct password?', { cause: e });\r\n            if (!e) throw new Exceptions.InternalError(`Unexpected error.`, { cause: e });\r\n        }\r\n    };\r\n\r\n    // \u8BFB\u53D6chunk\r\n    let EOFbit = false;\r\n    for (let i = start_chunk; i <= end_chunk; i++) {\r\n        const decrypted_chunk = await read_chunk(i);\r\n        if (!decrypted_chunk) {\r\n            EOFbit = true;\r\n            break;\r\n        }\r\n        result.push(decrypted_chunk);\r\n    }\r\n\r\n    // \u5408\u6210Blob\r\n    const blob_full = new Blob(result);\r\n    // \u88C1\u526A\u9700\u8981\u7684\u90E8\u5206\r\n    const startpos = start_chunk * chunk_size;\r\n    // const endpos = (end_chunk + 1) * chunk_size - 1;\r\n    // bytes_start, bytes_end\r\n    const blob = blob_full.slice(bytes_start - startpos, bytes_end - startpos);\r\n    \r\n    // @ts-ignore\r\n    if (EOFbit) blob.eof = true;\r\n    return blob;\r\n}\r\n", "export const VERSION = 'Encryption/5.5 FileEncryption/1.2 Patch/5.0';\r\n"],
  "mappings": "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",
  "names": ["hexTable", "i", "hexlify", "data", "length", "arr", "throwing", "unhexlify", "hexStr", "bytes", "highCode", "lowCode", "high", "low", "get_random_bytes", "count", "randomBytes", "get_random_int8_number", "get_random_uint8_number", "str_encode", "input", "encoding", "str_decode", "exceptions_exports", "__export", "BadDataException", "CannotDecryptException", "CryptContextNotInitedException", "CryptContextReleasedException", "CryptContextReusedException", "EncryptionError", "EncryptionVersionMismatchException", "EndOfFileException", "FileCorruptedException", "IVException", "InternalError", "InvalidCryptContextTypeException", "InvalidEndMarkerException", "InvalidFileFormatException", "InvalidParameterException", "InvalidScryptParameterException", "NotSupportedException", "raise", "message", "additional", "load_script", "src", "resolve", "reject", "script", "e", "load_deps_es5", "deps_name", "deps_src", "load_script", "scryptAPI", "load_deps_es5", "scrypt", "queue", "running", "work", "task", "resolve", "reject", "p", "dk", "e", "r", "thread", "nextTick", "key", "salt", "N", "dklen", "onprogress", "deriveKey__phrases", "derive_key", "key", "iv", "phrase", "N", "salt", "dklen", "InvalidScryptParameterException", "get_random_bytes", "get_random_uint8_number", "InvalidParameterException", "parameter", "hexlify", "keyInput", "scrypt", "str_encode", "scrypt_hex", "r", "p", "safeparse", "json", "InvalidParameterException", "encrypt_data", "message", "key", "phrase", "N", "iv", "get_random_bytes", "derived_key", "parameter", "N2", "derive_key", "cipher", "str_encode", "ciphertext", "encrypted_message", "message_encrypted", "hexlify", "decrypt_data", "jsoned", "encrypted_data", "unhexlify", "salt_b64", "salt", "BadDataException", "tag", "decrypted_data", "str_decode", "e", "InternalError", "name", "CannotDecryptException", "timerproc", "nextTick", "r", "PADDING_SIZE", "END_IDENTIFIER", "TAIL_BLOCK_MARKER", "END_MARKER", "FILE_END_MARKER", "normalize_version", "major_version", "version_marker", "ENCRYPTION_FILE_VER_1_1_0", "ENCRYPTION_FILE_VER_1_2_10020", "encrypt_file", "file_reader", "file_writer", "user_key", "callback", "phrase", "N", "chunk_size", "InvalidParameterException", "str_encode", "VERSION_MARKER", "versionMarkerBuffer", "key", "hexlify", "get_random_bytes", "ekey", "encrypt_data", "ekey_bytes", "InternalError", "lengthBuffer", "padding", "iv_for_key", "derived_key", "parameter", "N2", "derive_key", "header_data", "header_json", "headerLengthBuffer", "chunkSizeBuffer", "total_bytes", "nonce_counter", "position", "nonce_counter_start", "cryptoKey", "chunk", "BadDataException", "isFinalChunk", "iv", "IVException", "chunkLengthBuffer", "ivArray", "ciphertext", "ciphertextArray", "totalBytesBuffer", "decrypt_file_V_1_1_0", "header", "str_decode", "read_pos", "ekey_len_bytes", "ekey_len", "decrypt_data", "json_len_bytes", "json_len", "salt_hex", "salt", "unhexlify", "iv4key", "chunk_len_bytes", "v", "i", "chunk_len", "full_ciphertext", "decrypted", "total_bytes_bytes", "total_bytes_decrypted", "end_marker", "FileCorruptedException", "InvalidEndMarkerException", "decrypt_file", "InvalidFileFormatException", "top_header_version", "EncryptionVersionMismatchException", "version", "header_version", "is_final_chunk", "chunk_tag", "real_size", "full_bytes", "ciphertext_length", "iv_array", "e", "name", "CannotDecryptException", "export_master_key", "file_head", "current_key", "export_key", "BadDataException", "InvalidFileFormatException", "top_header_version", "EncryptionVersionMismatchException", "version_marker", "version", "normalize_version", "ENCRYPTION_FILE_VER_1_1_0", "ekey_len", "buffer", "ekey_ciphertext", "str_decode", "encrypt_data", "decrypt_data", "ENCRYPTION_FILE_VER_1_2_10020", "PADDING_SIZE", "change_file_password_1_1_0", "new_key", "headerBlob", "new_ekey", "new_ekey_len", "new_ekey_len_bytes", "new_ekey_parts", "str_encode", "padding", "change_file_password", "CRYPT_CONTEXT", "_await", "PromiseLike", "crypt_context_create", "ctx", "CRYPT_CONTEXT", "crypt_context_destroy", "InvalidParameterException", "i", "o", "Stream", "#reader", "#cache", "#size", "reader", "size", "InvalidParameterException", "#abort_controller", "start", "end", "suggestion_end", "abort", "data", "decrypt_stream_init", "ctx", "stream", "password", "cache", "cache_max_size", "CryptContextReusedException", "header", "str_decode", "InvalidFileFormatException", "top_header_version", "EncryptionVersionMismatchException", "version_marker", "version", "normalize_version", "read_pos", "ENCRYPTION_FILE_VER_1_2_10020", "NotSupportedException", "ekey_len", "ekey", "PADDING_SIZE", "InternalError", "key", "decrypt_data", "json_len_bytes", "json_len", "header_json", "header_version", "phrase", "salt_hex", "salt", "unhexlify", "iv4key", "N", "chunk_size", "nonce_counter", "derived_key", "derive_key", "cryptoKey", "decrypt_stream", "bytes_start", "bytes_end", "CryptContextNotInitedException", "InvalidCryptContextTypeException", "CryptContextReleasedException", "nonce_counter_start", "result", "chunks_start", "size_per_chunk", "max_chunk", "FILE_END_MARKER", "start_chunk", "end_chunk", "read_chunk", "chunk", "pos", "eight_bytes", "real_size", "v", "i", "END_IDENTIFIER", "full_bytes", "END_MARKER", "TAIL_BLOCK_MARKER", "chunk_len_bytes", "ciphertext_length", "ciphertext", "iv_array", "oldest_chunk", "e", "name", "CannotDecryptException", "EOFbit", "decrypted_chunk", "blob_full", "startpos", "blob", "VERSION"]
}
